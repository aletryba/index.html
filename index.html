<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Kalkulator Płyt Warstwowych - Dach Zbiornika</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 100vh; }
        .card { box-shadow: 0 10px 30px rgba(0,0,0,0.15); }
        .table th { background-color: #0d6efd; color: white; }
        .last-row { background-color: #fff3cd !important; }
        .waste { color: #d32f2f; font-weight: bold; }
    </style>
</head>
<body class="py-5">
<div class="container">

    <div class="text-center mb-5">
        <h1 class="display-5 fw-bold text-primary"><i class="fas fa-calculator"></i> Kalkulator PWD</h1>
        <p class="lead">Układ płyt warstwowych na dachu zbiornika</p>
    </div>

    <div class="card mb-4">
        <div class="card-body">
            <form id="calcForm">
                <div class="row g-3">
                    <div class="col-md-3">
                        <label class="form-label fw-bold">Model dachu / zbiornika</label>
                        <input type="number" class="form-control" id="model" value="4" min="3" max="32" step="1" required>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label fw-bold">Szer. modularna [m]</label>
                        <input type="number" class="form-control" id="szer_mod" value="1.05" min="0.10" max="4.00" step="0.01" required>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label fw-bold">Odsadzka [m]</label>
                        <input type="number" class="form-control" id="ods" value="0.08" min="0.00" max="0.70" step="0.01" required>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label fw-bold">Dł. max płyty [m]</label>
                        <input type="number" class="form-control" id="dl_max" value="12.5" step="0.1">
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div id="wynik"></div>
</div>

<script>
function oblicz() {
    const model = parseFloat(document.getElementById('model').value);
    const szer_mod = parseFloat(document.getElementById('szer_mod').value);
    const ods = parseFloat(document.getElementById('ods').value);
    const dl_max = parseFloat(document.getElementById('dl_max').value);

    if (isNaN(model) || model < 3 || model > 32) {
        alert("Model dachu musi być z zakresu 3–32");
        return;
    }

    const sr_zbiornika = model * 2.4 / Math.PI;
    const sr_dachu = sr_zbiornika + 2 * ods;
    const promien = sr_dachu / 2;
    const lacz_pol = sr_dachu > dl_max;
    const liczba_plyt = Math.ceil(sr_dachu / szer_mod);
    const parzysta = liczba_plyt % 2 === 0;

    const first_joint = parzysta ? szer_mod : szer_mod / 2;

    let ds = [0.0];
    let d = first_joint;
    while (d <= promien + 0.00001) {
        ds.push(Math.round(d * 1e10) / 1e10);
        d += szer_mod;
    }

    const offset_count = ds.length - 1;

    let dlugosci = ds.map(dd => 
        lacz_pol 
            ? Math.round(Math.sqrt(promien**2 - dd**2) * 1000) / 1000 
            : Math.round(2 * Math.sqrt(promien**2 - dd**2) * 1000) / 1000
    );

    let liczby_sztuk = parzysta 
        ? (lacz_pol ? [4, ...Array(offset_count).fill(4)] : [2, ...Array(offset_count).fill(2)])
        : (lacz_pol ? [2, ...Array(offset_count).fill(4)] : [1, ...Array(offset_count).fill(2)]);

    let szerokosci = Array(ds.length).fill(szer_mod);
    const pozost = promien - ds[ds.length-1];
    if (pozost < szer_mod) {
        szerokosci[szerokosci.length-1] = Math.round(pozost * 1000) / 1000;
    }

    // Oblicz powierzchnię przed przycięciem (używając szer_mod dla wszystkich)
    let powierzchnia = 0;
    for (let i = 0; i < dlugosci.length; i++) {
        powierzchnia += dlugosci[i] * szer_mod * liczby_sztuk[i];
    }
    powierzchnia = Math.round(powierzchnia * 100) / 100; // zaokrąglenie do 2 miejsc

    const modelDisplay = (model < 10 ? '0' + model : model) + 'XX';

    // === Generowanie HTML ===
    let html = `
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0"><i class="fas fa-table"></i> Wynik obliczeń</h4>
            </div>
            <div class="card-body">
                <div class="row mb-4">
                    <div class="col-md-6">
                        <strong>Model:</strong> ${modelDisplay}<br>
                        <strong>Średnica zbiornika:</strong> ${sr_zbiornika.toFixed(3)} m<br>
                        <strong>Średnica dachu:</strong> ${sr_dachu.toFixed(3)} m
                    </div>
                    <div class="col-md-6">
                        <strong>Odsadzka:</strong> ${ods} m ${Math.abs(ods - 0.08) < 0.001 ? '(wewnętrzna)' : Math.abs(ods - 0.20) < 0.001 ? '(zewnętrzna)' : ''}<br>
                        <strong>Szer. modularna:</strong> ${szer_mod} m ${Math.abs(szer_mod - 1.05) < 0.001 ? '(Pruszyński)' : Math.abs(szer_mod - 1.00) < 0.001 ? '(Balex)' : ''}<br>
                        <strong>Łączenie płyt w połowie:</strong> <span class="badge bg-${lacz_pol ? 'success' : 'secondary'}">${lacz_pol ? 'TAK' : 'NIE'}</span><br>
                    </div>
                </div>

                <div class="table-responsive">
                    <table class="table table-hover align-middle text-center">
                        <thead>
                            <tr>
                                <th>Długość [mb]</th>
                                <th>Liczba szt.</th>
                                <th>Szerokość [m]</th>
                            </tr>
                        </thead>
                        <tbody>`;

    ds.forEach((_, i) => {
        const isLast = i === ds.length-1 && szerokosci[i] !== szer_mod;
        const szerBold = isLast ? `<strong>${szerokosci[i].toFixed(3)}</strong>` : szerokosci[i].toFixed(3);
        html += `
            <tr class="${isLast ? 'last-row' : ''}">
                <td>${dlugosci[i].toFixed(3)}</td>
                <td>${liczby_sztuk[i]}</td>
                <td>${szerBold}</td>
            </tr>`;
    });

    html += `</tbody></table></div>
                <div class="mt-3">
                    <strong>Powierzchnia całkowita płyt przed przycięciem: ${powierzchnia.toFixed(2)} m²</strong>
                </div>`;

    // Wyjątki
    const isSpecial4 = (model === 4 && Math.abs(szer_mod - 1.05) < 0.001 && Math.abs(ods - 0.08) < 0.001);
    const isSpecial11 = (model === 11 && Math.abs(szer_mod - 1.05) < 0.001 && Math.abs(ods - 0.08) < 0.001);
    const isSpecial15 = (model === 15 && Math.abs(szer_mod - 1.05) < 0.001 && Math.abs(ods - 0.08) < 0.001);
    const isSpecial22 = (model === 22 && Math.abs(szer_mod - 1.05) < 0.001 && Math.abs(ods - 0.08) < 0.001);
    const isSpecial26 = (model === 26 && Math.abs(szer_mod - 1.05) < 0.001 && Math.abs(ods - 0.08) < 0.001);

    if (isSpecial4 || isSpecial11 || isSpecial15 || isSpecial22 || isSpecial26) {
        let altTable = '';
        let altPowierzchnia = 0;
        if (isSpecial4) {
            altTable = `
                <tr><td><strong>3.216</strong></td><td class="text-end">1 szt.</td><td class="text-end">1.05 m</td></tr>
                <tr><td><strong>3.040</strong></td><td class="text-end">2 szt.</td><td class="text-end">1.05 m</td></tr>
                <tr class="table-danger"><td class="waste"><strong>0.648</strong></td><td class="text-end waste">2 szt.</td><td class="text-end waste">0.04 m [z odpadu!]</td></tr>`;
            // Powierzchnia przed przycięciem: tylko pełne płyty
            altPowierzchnia = (3.216 * 1.05 * 1) + (3.040 * 1.05 * 2);
            altPowierzchnia = Math.round(altPowierzchnia * 100) / 100;
        } else if (isSpecial11) {
            altTable = `
                <tr><td><strong>8.563</strong></td><td class="text-end">2 szt.</td><td class="text-end">1.05 m</td></tr>
                <tr><td><strong>8.302</strong></td><td class="text-end">2 szt.</td><td class="text-end">1.05 m</td></tr>
                <tr><td><strong>7.463</strong></td><td class="text-end">2 szt.</td><td class="text-end">1.05 m</td></tr>
                <tr><td><strong>5.800</strong></td><td class="text-end">2 szt.</td><td class="text-end">1.05 m</td></tr>
                <tr class="table-danger"><td class="waste"><strong>1.663</strong></td><td class="text-end waste">2 szt.</td><td class="text-end waste">0.09 m [z odpadu!]</td></tr>`;
            altPowierzchnia = (8.563 * 1.05 * 2) + (8.302 * 1.05 * 2) + (7.463 * 1.05 * 2) + (5.800 * 1.05 * 2);
            altPowierzchnia = Math.round(altPowierzchnia * 100) / 100;
        } else if (isSpecial15) {
            altTable = `
                <tr><td><strong>11.619</strong></td><td class="text-end">1 szt.</td><td class="text-end">1.05 m</td></tr>
                <tr><td><strong>11.572</strong></td><td class="text-end">2 szt.</td><td class="text-end">1.05 m</td></tr>
                <tr><td><strong>11.184</strong></td><td class="text-end">2 szt.</td><td class="text-end">1.05 m</td></tr>
                <tr><td><strong>10.366</strong></td><td class="text-end">2 szt.</td><td class="text-end">1.05 m</td></tr>
                <tr><td><strong>8.999</strong></td><td class="text-end">2 szt.</td><td class="text-end">1.05 m</td></tr>
                <tr><td><strong>6.761</strong></td><td class="text-end">2 szt.</td><td class="text-end">1.05 m</td></tr>
                <tr class="table-danger"><td class="waste"><strong>1.265</strong></td><td class="text-end waste">2 szt.</td><td class="text-end waste">0.04 m [z odpadu!]</td></tr>`;
            altPowierzchnia = (11.619 * 1.05 * 1) + (11.572 * 1.05 * 2) + (11.184 * 1.05 * 2) + (10.366 * 1.05 * 2) + (8.999 * 1.05 * 2) + (6.761 * 1.05 * 2);
            altPowierzchnia = Math.round(altPowierzchnia * 100) / 100;
        } else if (isSpecial22) {
            altTable = `
                <tr><td><strong>8.484</strong></td><td class="text-end">4 szt.</td><td class="text-end">1.05 m</td></tr>
                <tr><td><strong>8.419</strong></td><td class="text-end">4 szt.</td><td class="text-end">1.05 m</td></tr>
                <tr><td><strong>8.220</strong></td><td class="text-end">4 szt.</td><td class="text-end">1.05 m</td></tr>
                <tr><td><strong>7.878</strong></td><td class="text-end">4 szt.</td><td class="text-end">1.05 m</td></tr>
                <tr><td><strong>7.371</strong></td><td class="text-end">4 szt.</td><td class="text-end">1.05 m</td></tr>
                <tr><td><strong>6.664</strong></td><td class="text-end">4 szt.</td><td class="text-end">1.05 m</td></tr>
                <tr><td><strong>5.682</strong></td><td class="text-end">4 szt.</td><td class="text-end">1.05 m</td></tr>
                <tr><td><strong>4.237</strong></td><td class="text-end">4 szt.</td><td class="text-end">1.05 m</td></tr>
                <tr class="table-danger"><td class="waste"><strong>1.188</strong></td><td class="text-end waste">4 szt.</td><td class="text-end waste">0.09 m [z odpadu!]</td></tr>`;
            altPowierzchnia = (8.484 * 1.05 * 4) + (8.419 * 1.05 * 4) + (8.220 * 1.05 * 4) + (7.878 * 1.05 * 4) + (7.371 * 1.05 * 4) + (6.664 * 1.05 * 4) + (5.682 * 1.05 * 4) + (4.237 * 1.05 * 4);
            altPowierzchnia = Math.round(altPowierzchnia * 100) / 100;
        } else if (isSpecial26) {
            altTable = `
                <tr><td><strong>10.012</strong></td><td class="text-end">2 szt.</td><td class="text-end">1.05 m</td></tr>
                <tr><td><strong>9.998</strong></td><td class="text-end">4 szt.</td><td class="text-end">1.05 m</td></tr>
                <tr><td><strong>9.887</strong></td><td class="text-end">4 szt.</td><td class="text-end">1.05 m</td></tr>
                <tr><td><strong>9.662</strong></td><td class="text-end">4 szt.</td><td class="text-end">1.05 m</td></tr>
                <tr><td><strong>9.313</strong></td><td class="text-end">4 szt.</td><td class="text-end">1.05 m</td></tr>
                <tr><td><strong>8.827</strong></td><td class="text-end">4 szt.</td><td class="text-end">1.05 m</td></tr>
                <tr><td><strong>8.178</strong></td><td class="text-end">4 szt.</td><td class="text-end">1.05 m</td></tr>
                <tr><td><strong>7.325</strong></td><td class="text-end">4 szt.</td><td class="text-end">1.05 m</td></tr>
                <tr><td><strong>6.182</strong></td><td class="text-end">4 szt.</td><td class="text-end">1.05 m</td></tr>
                <tr><td><strong>4.536</strong></td><td class="text-end">4 szt.</td><td class="text-end">1.05 m</td></tr>
                <tr class="table-danger"><td class="waste"><strong>0.854</strong></td><td class="text-end waste">4 szt.</td><td class="text-end waste">0.04 m [z odpadu!]</td></tr>`;
            altPowierzchnia = (10.012 * 1.05 * 2) + (9.998 * 1.05 * 4) + (9.887 * 1.05 * 4) + (9.662 * 1.05 * 4) + (9.313 * 1.05 * 4) + (8.827 * 1.05 * 4) + (8.178 * 1.05 * 4) + (7.325 * 1.05 * 4) + (6.182 * 1.05 * 4) + (4.536 * 1.05 * 4);
            altPowierzchnia = Math.round(altPowierzchnia * 100) / 100;
        }

        html += `
            <div class="alert alert-warning mt-4 border border-warning border-2">
                <h5><i class="fas fa-exclamation-triangle"></i> UWAGA – Dla danego przypadku istnieje alternatywny układ PWD, który jednak spowoduje niecałkowite pokrycie!</h5>
                <p>Zajdzie konieczność uzupełnienia pianką (lub odpadem z PWD) i zakrycia obróbką blacharską.</p>
                <table class="table table-sm table-bordered bg-white mt-3">
                    ${altTable}
                </table>
                <strong>Powierzchnia całkowita płyt przed przycięciem: ${altPowierzchnia.toFixed(2)} m²</strong>
            </div>`;
    }

    html += `</div></div>`;
    document.getElementById('wynik').innerHTML = html;
}

// Automatyczne przeliczanie przy zmianie wartości
document.getElementById('model').addEventListener('input', oblicz);
document.getElementById('szer_mod').addEventListener('input', oblicz);
document.getElementById('ods').addEventListener('input', oblicz);
document.getElementById('dl_max').addEventListener('input', oblicz);

// Oblicz przy pierwszym załadowaniu
window.onload = oblicz;
</script>
</body>
</html>